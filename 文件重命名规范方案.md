# Forensic Keystore Cracker - Python 文件重命名规范方案

**版本**: 2.0
**日期**: 2025-11-20
**目标**: 使项目更加规范、明确清晰，遵循 Python 命名最佳实践

---

## 📋 目录

1. [重命名原则](#重命名原则)
2. [当前问题分析](#当前问题分析)
3. [命名规范标准](#命名规范标准)
4. [详细重命名方案](#详细重命名方案)
5. [实施步骤](#实施步骤)
6. [影响分析](#影响分析)
7. [回滚方案](#回滚方案)
8. [验证清单](#验证清单)

---

## 🎯 重命名原则

### 1. **清晰性 (Clarity)**
- 文件名应准确反映其功能和职责
- 避免过长的名称（建议 ≤ 25 字符）
- 避免模糊或通用的词汇

### 2. **一致性 (Consistency)**
- 统一使用命名模式：`<功能>_<组件类型>.py`
- 工具类：`<action>_<object>.py` (如 `extract_hash.py`)
- 处理器类：`<object>_<processor>.py` (如 `batch_processor.py`)
- 服务类：`<object>_<service>.py` (如 `gpu_service.py`)

### 3. **简洁性 (Conciseness)**
- 去除冗余词汇（如 `batch_` 前缀可能重复）
- 使用标准缩写（如 `cert` 代替 `certificate`）
- 避免重复上下文信息

### 4. **可维护性 (Maintainability)**
- 文件名应与主类名对应
- 易于搜索和定位
- 遵循 PEP 8 命名规范

---

## 🔍 当前问题分析

### 存在的问题

| 当前文件名 | 主类名 | 问题 |
|-----------|--------|------|
| `batch_hash_extractor.py` | `BatchHashExtractor` | ✅ 匹配良好，但略长 |
| `ultimate_batch_cracker.py` | `UltimateBatchCracker` | ⚠️ "ultimate" 过于营销化，不专业 |
| `gpu_hashcat_cracker.py` | `GPUHashcatCracker` | ⚠️ 冗余（hashcat 已暗示 GPU），过长 |
| `certificate_extractor.py` | `CertificateExtractor` | ✅ 较好，但可简化 |
| `keystore_info_extractor.py` | `KeystoreInfoExtractor` | ⚠️ 过长，`info` 和 `extractor` 冗余 |
| `progress_manager.py` | `ProgressManager` | ✅ 清晰合理 |
| `batch_result_analyzer.py` | `BatchResultAnalyzer` | ⚠️ `batch` + `result` 冗余 |
| `gpu_monitor.py` | `GPUMonitor` | ✅ 清晰合理 |

### 命名模式不一致

1. **提取器组**: `*_extractor.py`（3个文件）
2. **处理器组**: `*_cracker.py`（2个文件）
3. **管理器组**: `*_manager.py`、`*_analyzer.py`、`*_monitor.py`（3个文件）

**问题**: 没有统一的层次结构和分类逻辑

---

## 📐 命名规范标准

### 分类命名规则

根据项目架构，将文件分为以下类别：

#### 1️⃣ **核心工具 (Core Tools)** - 前缀 `cli_`
- 命令行入口工具，供用户直接调用
- **命名格式**: `cli_<功能>.py`
- **示例**: `cli_crack.py`, `cli_extract_hash.py`

#### 2️⃣ **处理引擎 (Processors)** - 后缀 `_processor.py`
- 核心业务逻辑处理器
- **命名格式**: `<object>_processor.py`
- **示例**: `crack_processor.py`, `hash_processor.py`

#### 3️⃣ **服务组件 (Services)** - 后缀 `_service.py`
- 对外部工具的封装（GPU、Java工具等）
- **命名格式**: `<tool>_service.py`
- **示例**: `hashcat_service.py`, `gpu_service.py`

#### 4️⃣ **提取器 (Extractors)** - 后缀 `_extractor.py`
- 数据提取和分析工具
- **命名格式**: `<object>_extractor.py`
- **示例**: `cert_extractor.py`, `keystore_extractor.py`

#### 5️⃣ **管理器 (Managers)** - 后缀 `_manager.py`
- 状态管理、进度跟踪等
- **命名格式**: `<object>_manager.py`
- **示例**: `progress_manager.py`, `session_manager.py`

---

## 🔄 详细重命名方案

### 方案 A: 保守改进（推荐）⭐

**原则**: 最小化改动，优化冗余和不规范名称

| 旧文件名 | 新文件名 | 主类名 | 改动原因 |
|---------|---------|--------|---------|
| `batch_hash_extractor.py` | `hash_extractor.py` | `HashExtractor` | 去除冗余的 `batch_` 前缀 |
| `ultimate_batch_cracker.py` | `batch_cracker.py` | `BatchCracker` | 去除营销化词汇 "ultimate" |
| `gpu_hashcat_cracker.py` | `hashcat_service.py` | `HashcatService` | 简化名称，突出服务性质 |
| `certificate_extractor.py` | `cert_extractor.py` | `CertExtractor` | 简化为标准缩写 |
| `keystore_info_extractor.py` | `keystore_extractor.py` | `KeystoreExtractor` | 去除冗余 `info_` |
| `progress_manager.py` | ✅ **保持不变** | `ProgressManager` | 已经很规范 |
| `batch_result_analyzer.py` | `result_analyzer.py` | `ResultAnalyzer` | 去除冗余 `batch_` |
| `gpu_monitor.py` | ✅ **保持不变** | `GPUMonitor` | 已经很规范 |

**优点**:
- ✅ 改动最小，风险低
- ✅ 保持向后兼容性
- ✅ 去除明显的冗余和不规范
- ✅ 适合快速迭代

**缺点**:
- ❌ 没有统一的分类层次
- ❌ 文件角色不够明确

---

### 方案 B: 彻底重构（激进）

**原则**: 按照功能分层，统一命名规范

| 旧文件名 | 新文件名 | 主类名 | 分类 |
|---------|---------|--------|------|
| `batch_hash_extractor.py` | `cli_extract_hash.py` | `HashExtractCLI` | CLI工具 |
| `ultimate_batch_cracker.py` | `cli_crack_batch.py` | `BatchCrackCLI` | CLI工具 |
| `gpu_hashcat_cracker.py` | `hashcat_service.py` | `HashcatService` | 服务组件 |
| `certificate_extractor.py` | `cert_extractor.py` | `CertExtractor` | 提取器 |
| `keystore_info_extractor.py` | `keystore_extractor.py` | `KeystoreExtractor` | 提取器 |
| `progress_manager.py` | `session_manager.py` | `SessionManager` | 管理器 |
| `batch_result_analyzer.py` | `result_analyzer.py` | `ResultAnalyzer` | 分析器 |
| `gpu_monitor.py` | `gpu_monitor.py` | `GPUMonitor` | 监控器 |

**新增结构**:
```
forensic-keystore-cracker/
├── cli/                          # 命令行工具
│   ├── cli_crack_batch.py
│   └── cli_extract_hash.py
├── services/                     # 服务组件
│   ├── hashcat_service.py
│   └── gpu_monitor.py
├── extractors/                   # 提取器
│   ├── cert_extractor.py
│   └── keystore_extractor.py
└── core/                         # 核心组件
    ├── session_manager.py
    └── result_analyzer.py
```

**优点**:
- ✅ 结构清晰，职责分明
- ✅ 易于扩展和维护
- ✅ 符合大型项目规范

**缺点**:
- ❌ 改动巨大，迁移成本高
- ❌ 破坏现有用户脚本
- ❌ 需要重写导入逻辑

---

### 方案 C: 混合优化（平衡）

**原则**: 保持扁平结构，优化命名，添加前缀分类

| 旧文件名 | 新文件名 | 主类名 | 类别前缀 |
|---------|---------|--------|---------|
| `batch_hash_extractor.py` | `tool_extract_hash.py` | `HashExtractTool` | `tool_` |
| `ultimate_batch_cracker.py` | `tool_crack_batch.py` | `BatchCrackTool` | `tool_` |
| `gpu_hashcat_cracker.py` | `engine_hashcat.py` | `HashcatEngine` | `engine_` |
| `certificate_extractor.py` | `extract_cert.py` | `CertExtractor` | `extract_` |
| `keystore_info_extractor.py` | `extract_keystore.py` | `KeystoreExtractor` | `extract_` |
| `progress_manager.py` | `manage_progress.py` | `ProgressManager` | `manage_` |
| `batch_result_analyzer.py` | `analyze_result.py` | `ResultAnalyzer` | `analyze_` |
| `gpu_monitor.py` | `monitor_gpu.py` | `GPUMonitor` | `monitor_` |

**优点**:
- ✅ 通过前缀实现分类
- ✅ 保持扁平结构
- ✅ 文件按功能自然分组

**缺点**:
- ❌ 前缀可能显得冗余
- ❌ 改动中等，需调整文档

---

## 🚀 实施步骤

### 阶段 1: 准备工作（1天）

#### 1.1 备份当前版本
```bash
# 创建备份分支
git checkout -b backup-before-rename-$(date +%Y%m%d)
git push origin backup-before-rename-$(date +%Y%m%d)

# 创建备份目录
mkdir -p backup/original_files
cp *.py backup/original_files/
```

#### 1.2 文档审查
- ✅ 检查所有文档中的文件引用
- ✅ 列出所有需要更新的位置：
  - `README.md`
  - `CLAUDE.md`
  - `requirements.txt` 的注释
  - 示例脚本

#### 1.3 依赖分析
```bash
# 检查是否有外部脚本导入这些模块
grep -r "import batch_hash_extractor" .
grep -r "from batch_hash_extractor" .
# 对每个文件重复
```

---

### 阶段 2: 执行重命名（2-4小时）

#### 2.1 文件重命名脚本（方案A示例）

```python
# rename_script.py
import os
import shutil
from pathlib import Path

# 定义重命名映射（方案A）
RENAME_MAP = {
    'batch_hash_extractor.py': 'hash_extractor.py',
    'ultimate_batch_cracker.py': 'batch_cracker.py',
    'gpu_hashcat_cracker.py': 'hashcat_service.py',
    'certificate_extractor.py': 'cert_extractor.py',
    'keystore_info_extractor.py': 'keystore_extractor.py',
    'batch_result_analyzer.py': 'result_analyzer.py',
    # progress_manager.py 和 gpu_monitor.py 保持不变
}

def rename_files():
    for old_name, new_name in RENAME_MAP.items():
        if Path(old_name).exists():
            print(f"重命名: {old_name} -> {new_name}")
            shutil.move(old_name, new_name)
        else:
            print(f"⚠️ 文件不存在: {old_name}")

def update_class_names():
    """
    更新文件内的类名以匹配新文件名
    """
    CLASS_RENAME_MAP = {
        'hash_extractor.py': ('BatchHashExtractor', 'HashExtractor'),
        'batch_cracker.py': ('UltimateBatchCracker', 'BatchCracker'),
        'hashcat_service.py': ('GPUHashcatCracker', 'HashcatService'),
        'cert_extractor.py': ('CertificateExtractor', 'CertExtractor'),
        'keystore_extractor.py': ('KeystoreInfoExtractor', 'KeystoreExtractor'),
        'result_analyzer.py': ('BatchResultAnalyzer', 'ResultAnalyzer'),
    }

    for file_name, (old_class, new_class) in CLASS_RENAME_MAP.items():
        if Path(file_name).exists():
            with open(file_name, 'r', encoding='utf-8') as f:
                content = f.read()

            # 替换类定义
            content = content.replace(f'class {old_class}:', f'class {new_class}:')
            # 替换类引用
            content = content.replace(f'{old_class}(', f'{new_class}(')

            with open(file_name, 'w', encoding='utf-8') as f:
                f.write(content)

            print(f"✅ 更新类名: {file_name} ({old_class} -> {new_class})")

if __name__ == '__main__':
    print("开始重命名文件...")
    rename_files()
    print("\n更新类名...")
    update_class_names()
    print("\n✅ 重命名完成!")
```

#### 2.2 执行重命名
```bash
# 运行重命名脚本
python rename_script.py

# 验证结果
ls -la *.py
```

---

### 阶段 3: 更新文档和引用（2-4小时）

#### 3.1 批量替换文档

```python
# update_docs.py
from pathlib import Path

DOC_FILES = [
    'README.md',
    'CLAUDE.md',
    'docs/USAGE.md',
    # 添加其他文档
]

# 文档中的替换映射
DOC_REPLACE_MAP = {
    'batch_hash_extractor.py': 'hash_extractor.py',
    'ultimate_batch_cracker.py': 'batch_cracker.py',
    'gpu_hashcat_cracker.py': 'hashcat_service.py',
    'certificate_extractor.py': 'cert_extractor.py',
    'keystore_info_extractor.py': 'keystore_extractor.py',
    'batch_result_analyzer.py': 'result_analyzer.py',

    # 类名替换
    'BatchHashExtractor': 'HashExtractor',
    'UltimateBatchCracker': 'BatchCracker',
    'GPUHashcatCracker': 'HashcatService',
    'CertificateExtractor': 'CertExtractor',
    'KeystoreInfoExtractor': 'KeystoreExtractor',
    'BatchResultAnalyzer': 'ResultAnalyzer',
}

def update_documentation():
    for doc_file in DOC_FILES:
        path = Path(doc_file)
        if not path.exists():
            print(f"⚠️ 文档不存在: {doc_file}")
            continue

        with open(path, 'r', encoding='utf-8') as f:
            content = f.read()

        original_content = content
        for old_text, new_text in DOC_REPLACE_MAP.items():
            content = content.replace(old_text, new_text)

        if content != original_content:
            with open(path, 'w', encoding='utf-8') as f:
                f.write(content)
            print(f"✅ 更新文档: {doc_file}")
        else:
            print(f"ℹ️ 无需更新: {doc_file}")

if __name__ == '__main__':
    update_documentation()
```

#### 3.2 更新命令行帮助
- 检查 argparse 的 `description` 和 `help` 文本
- 更新脚本内的字符串引用

---

### 阶段 4: 测试验证（4-8小时）

#### 4.1 功能测试清单

```bash
# 1. 测试 Hash 提取
python hash_extractor.py -m ?a?a?a?a?a?a --help
python hash_extractor.py -d test_data/ -m ?a?a?a?a?a?a

# 2. 测试批量破解
python batch_cracker.py -m ?a?a?a?a?a?a --help
python batch_cracker.py -d test_data/ -m ?a?a?a?a?a?a

# 3. 测试 GPU 破解服务
python hashcat_service.py test_hash.txt -m ?a?a?a?a?a?a --help

# 4. 测试证书提取
python cert_extractor.py test.jks password123 --help

# 5. 测试 Keystore 提取
python keystore_extractor.py test.jks password123 --help

# 6. 测试进度管理
# （内部模块，通过其他工具间接测试）

# 7. 测试结果分析
# （内部模块，通过 batch_cracker.py 测试）

# 8. 测试 GPU 监控
python gpu_monitor.py --help
```

#### 4.2 回归测试
- ✅ 验证所有原有功能正常
- ✅ 检查输出格式未改变
- ✅ 确认生成的文件路径正确

#### 4.3 文档验证
- ✅ 所有示例命令可正常运行
- ✅ 没有遗漏的旧文件名引用
- ✅ README 和 CLAUDE.md 一致性

---

### 阶段 5: 发布更新（1天）

#### 5.1 版本管理
```bash
# 创建新版本分支
git checkout -b feature/rename-files-v2

# 添加所有变更
git add .

# 提交变更
git commit -m "refactor: 重命名 Python 文件以提升规范性

- 重命名 batch_hash_extractor.py -> hash_extractor.py
- 重命名 ultimate_batch_cracker.py -> batch_cracker.py
- 重命名 gpu_hashcat_cracker.py -> hashcat_service.py
- 重命名 certificate_extractor.py -> cert_extractor.py
- 重命名 keystore_info_extractor.py -> keystore_extractor.py
- 重命名 batch_result_analyzer.py -> result_analyzer.py
- 更新所有文档和类名
- 保持向后兼容性（已测试）

BREAKING CHANGE: 文件名已更改，外部脚本需更新导入路径"
```

#### 5.2 发布说明（CHANGELOG.md）

```markdown
## [2.0.0] - 2025-11-20

### 💥 Breaking Changes
- 重命名主要 Python 文件以提升代码规范性和可读性

### ✨ 改进
- 去除冗余和营销化词汇（如 "ultimate", "batch_" 前缀）
- 统一命名风格，符合 Python PEP 8 规范
- 简化类名，提升代码可维护性

### 📝 文件重命名对照表
| 旧文件名 | 新文件名 | 说明 |
|---------|---------|------|
| `batch_hash_extractor.py` | `hash_extractor.py` | 去除冗余前缀 |
| `ultimate_batch_cracker.py` | `batch_cracker.py` | 去除营销化词汇 |
| `gpu_hashcat_cracker.py` | `hashcat_service.py` | 简化并突出服务性质 |
| `certificate_extractor.py` | `cert_extractor.py` | 使用标准缩写 |
| `keystore_info_extractor.py` | `keystore_extractor.py` | 去除冗余 info |
| `batch_result_analyzer.py` | `result_analyzer.py` | 去除冗余前缀 |

### 🔄 迁移指南
**如果您在外部脚本中导入了这些模块**，请更新导入语句：

```python
# 旧代码
from batch_hash_extractor import BatchHashExtractor
from ultimate_batch_cracker import UltimateBatchCracker

# 新代码
from hash_extractor import HashExtractor
from batch_cracker import BatchCracker
```

**命令行使用保持一致**，只需替换文件名：

```bash
# 旧命令
python ultimate_batch_cracker.py -m ?a?a?a?a?a?a

# 新命令
python batch_cracker.py -m ?a?a?a?a?a?a
```

### ⚙️ 兼容性
- ✅ 所有功能保持不变
- ✅ 命令行参数完全兼容
- ✅ 输出格式和结构不变
- ⚠️ 需要更新外部脚本的导入路径
```

#### 5.3 GitHub Release
- 创建 v2.0.0 标签
- 附上详细的 Release Notes
- 提供迁移脚本（可选）

---

## 📊 影响分析

### 影响范围评估

| 影响类型 | 方案A | 方案B | 方案C |
|---------|-------|-------|-------|
| **代码改动** | 6个文件 | 8个文件 + 目录结构 | 8个文件 |
| **文档更新** | 中等（2个文档） | 大（所有文档） | 中等 |
| **外部依赖** | 低（独立工具） | 高（可能影响导入） | 中等 |
| **用户迁移成本** | 低（仅命令行） | 高（导入路径变化） | 中等 |
| **测试工作量** | 2-4小时 | 8-16小时 | 4-8小时 |
| **风险等级** | 🟢 低 | 🔴 高 | 🟡 中 |

### 受影响的用户场景

#### 1. 命令行用户（大多数）
```bash
# 旧命令
python ultimate_batch_cracker.py -m ?a?a?a?a?a?a

# 新命令
python batch_cracker.py -m ?a?a?a?a?a?a
```
**影响**: ⚠️ 需要更新脚本和文档

#### 2. 脚本集成用户（少数）
```python
# 旧代码
from batch_hash_extractor import BatchHashExtractor
extractor = BatchHashExtractor()

# 新代码（方案A）
from hash_extractor import HashExtractor
extractor = HashExtractor()
```
**影响**: 🔴 破坏性变更，需要迁移

#### 3. 文档阅读者
**影响**: ✅ 改进后更清晰

---

## 🔙 回滚方案

### 快速回滚脚本

```python
# rollback.py
import shutil
from pathlib import Path

BACKUP_DIR = Path('backup/original_files')
CURRENT_DIR = Path('.')

def rollback():
    if not BACKUP_DIR.exists():
        print("❌ 备份目录不存在，无法回滚")
        return

    for backup_file in BACKUP_DIR.glob('*.py'):
        target = CURRENT_DIR / backup_file.name
        print(f"恢复: {backup_file.name}")
        shutil.copy(backup_file, target)

    print("✅ 回滚完成!")

if __name__ == '__main__':
    rollback()
```

### Git 回滚
```bash
# 方式1: 硬回滚到重命名前
git reset --hard backup-before-rename-20251120

# 方式2: 恢复特定文件
git checkout backup-before-rename-20251120 -- *.py

# 方式3: 回退提交
git revert <commit-hash>
```

---

## ✅ 验证清单

### 重命名前检查
- [ ] 已创建 Git 备份分支
- [ ] 已备份所有 `.py` 文件到 `backup/` 目录
- [ ] 已列出所有依赖此项目的外部脚本
- [ ] 已审查所有文档中的文件引用
- [ ] 已通知团队成员（如果适用）

### 重命名后验证
- [ ] 所有命令行工具可正常运行
- [ ] `--help` 参数输出正确
- [ ] 生成的输出文件路径正确
- [ ] README.md 中的所有示例可运行
- [ ] CLAUDE.md 中的架构图已更新
- [ ] 测试用例全部通过
- [ ] 没有遗漏的旧文件名引用
- [ ] Git 提交信息清晰完整

### 发布前确认
- [ ] 版本号已更新（如 v2.0.0）
- [ ] CHANGELOG.md 已编写
- [ ] 迁移指南已提供
- [ ] 旧版本文档已归档
- [ ] Release Notes 已准备
- [ ] 示例脚本已测试

---

## 🎯 最终推荐

### 推荐方案: **方案 A - 保守改进** ⭐⭐⭐⭐⭐

**理由**:
1. ✅ **最小化风险**: 改动范围可控，不涉及目录结构调整
2. ✅ **快速实施**: 2-4小时即可完成并测试
3. ✅ **用户友好**: 命令行使用者只需更新文件名
4. ✅ **效果显著**: 去除了主要的命名问题（ultimate、冗余前缀等）
5. ✅ **易于回滚**: 如有问题可快速恢复

### 实施时间表

| 阶段 | 时间 | 负责人 | 检查点 |
|------|------|--------|--------|
| 准备工作 | 0.5天 | 开发者 | 备份完成 |
| 执行重命名 | 0.25天 | 开发者 | 文件重命名完成 |
| 更新文档 | 0.5天 | 开发者/文档 | 文档无遗漏引用 |
| 测试验证 | 0.5天 | QA/开发者 | 所有测试通过 |
| 发布更新 | 0.25天 | 项目负责人 | Release 发布 |
| **总计** | **2天** | - | - |

---

## 📚 附录

### A. Python 命名规范参考

- **PEP 8**: https://peps.python.org/pep-0008/
- **Google Python Style Guide**: https://google.github.io/styleguide/pyguide.html

### B. 常用缩写标准

| 完整词汇 | 标准缩写 |
|---------|---------|
| certificate | cert |
| configuration | config |
| database | db |
| information | info |
| management | mgmt |
| temporary | temp |
| utilities | utils |

### C. 项目文件角色定义

- **CLI 工具**: 用户直接调用的命令行入口
- **服务 (Service)**: 对外部工具/API 的封装
- **处理器 (Processor)**: 核心业务逻辑
- **提取器 (Extractor)**: 数据提取和解析
- **管理器 (Manager)**: 状态/进度/会话管理
- **分析器 (Analyzer)**: 数据分析和报告生成
- **监控器 (Monitor)**: 实时状态监控

---

## 📞 联系和反馈

如果在实施过程中遇到问题，请：
1. 检查备份是否完整
2. 参考回滚方案
3. 提交 Issue 或联系维护者

---

**文档版本**: v2.0
**最后更新**: 2025-11-20
**维护者**: Forensic Keystore Cracker Team
